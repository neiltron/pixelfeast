!function t(e,n,i){function o(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n||t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(){requestAnimationFrame(o);var t=Date.now()-O;if(O=Date.now(),!(t>1e3)){D.save(),D.clearRect(0,0,m.width,m.height);var e=c.getScale(D);if(D.scale(e,e),_.default.translate(D),s.default.draw(D),g.default.length>0&&T.length>0){var n=_.default.getBounds();g.default.forEach(function(t,e){for(var i=0;i<T.length;i++){var o=T[i];if(t.playerID!=o.id&&((!(o.position[1]+o.height<n.y||o.position[1]>n.y+n.h)||!(o.position[0]+o.width<n.x||o.position[0]>n.x+n.w))&&t.detectCollision(o))){o.explode(),g.default.splice(e,1);break}}Date.now()-t.created>4e3?g.default.splice(e,1):(t.update(),t.draw(D))})}T.forEach(function(e,n){e.scale<.4?T.splice(n,1):e.draw(D,t)}),f.default.draw(D,t),D.restore()}}function r(){for(var t=0;t<50;t+=1)T.push(new p.default({position:[Math.random()*c.MAP_PIXEL_WIDTH,Math.random()*c.MAP_PIXEL_HEIGHT]}))}var a=t("./src/tiles"),s=i(a),u=t("./src/dimensions"),c=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(u),l=t("./src/copter"),h=(i(l),t("./src/player")),f=i(h),d=t("./src/enemy"),p=i(d),y=t("./src/camera"),_=i(y),v=t("./src/events"),I=i(v),E=t("./src/assets"),w=t("./src/projectiles"),g=i(w),m=document.querySelector("canvas");m.width=512,m.height=512;var D=m.getContext("2d"),O=Date.now(),T=[];s.default.generate();var b=function(){var t=Math.min(window.innerWidth,window.innerHeight);m.width=t,m.height=t};b(),window.addEventListener("resize",b),window.addEventListener("keydown",function(t){I.default.keyDown.dispatch(t)}),window.addEventListener("keyup",function(t){I.default.keyUp.dispatch(t)}),(0,E.loadImages)().then(o).then(r)},{"./src/assets":3,"./src/camera":4,"./src/copter":5,"./src/dimensions":6,"./src/enemy":7,"./src/events":8,"./src/player":9,"./src/projectiles":11,"./src/tiles":12}],2:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(){i(this,t),this._listeners=[],this._dispatchNb=0}return r(t,[{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{priority:0,once:!1,context:this},n=o({context:this},e,{function:t});if("function"!=typeof n.function)throw new TypeError("Signal.add() : First argument must be a Function");if(-1!==this._getListernerIndex(n.function,n.context))throw new Error("Signal.add() : Listener already exists");return this._listeners.push(n),this._listeners.sort(function(t,e){return t.priority<e.priority}),this}},{key:"once",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.add(t,o({},e,{once:!0}))}},{key:"remove",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;if("function"!=typeof t)throw new TypeError("Signal.remove() : First argument must be a Function");var n=this._getListernerIndex(t,e);if(-1===n)throw new Error("Signal.remove() : Listener does not exist");return this._listeners.splice(n,1),this}},{key:"removeAll",value:function(){return this._listeners=[],this}},{key:"dispatch",value:function(){if(++this._dispatchNb>512)throw new Error("Signal.dispatch() : Maximum dispatch limit reached (prevent infinite loop)");for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0;i<this._listeners.length;i++){var o,r=this._listeners[i];r.once&&this._listeners.splice(i);if(!1===(o=r.function).call.apply(o,[r.context].concat(e)))break}return this}},{key:"has",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return-1!==this._getListernerIndex(t,e)}},{key:"getListenersNb",value:function(){return this._listeners.length}},{key:"getDispatchNb",value:function(){return this._dispatchNb}},{key:"_getListernerIndex",value:function(t,e){for(var n=0,i=this._listeners.length;n<i;n++)if(this._listeners[n].function===t&&this._listeners[n].context===e)return n;return-1}}]),t}();n.default=a,e.exports=n.default},{}],3:[function(t,e,n){"use strict";function i(){return Promise.all(Object.keys(a).map(function(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){a[t]=i,e()},i.onerror=n,i.src=a[t]})})).then(function(){return r.default.imagesLoaded.dispatch(a),a})}Object.defineProperty(n,"__esModule",{value:!0}),n.images=void 0,n.loadImages=i;var o=t("./events"),r=function(t){return t&&t.__esModule?t:{default:t}}(o),a=n.images={drone:"./static/drone.png",drone_enemy:"./static/drone_enemy.png",grass:"./static/grass.png",road1:"./static/road1.png",road2:"./static/road2.png",road3:"./static/road3.png",house1:"./static/house-1.png",house2:"./static/house-2.png",house3:"./static/house-3.png",house4:"./static/house-4.png",house5:"./static/house-5.png",house6:"./static/house-6.png",house7:"./static/house-7.png",house8:"./static/house-8.png",house9:"./static/house-9.png",house10:"./static/house-10.png",explosion:"./static/explosion.png"}},{"./events":8}],4:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var o=t("./events"),r=(i(o),t("./player")),a=i(r),s=t("./dimensions"),u=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(s),c=0,l=0;n.default={translate:function(t){c=Math.max(0,Math.min(u.GRID_WIDTH*u.TILE_SIZE-u.VIEWPORT_WIDTH,a.default.position[0]-Math.floor(u.VIEWPORT_WIDTH/2))),l=Math.max(0,Math.min(u.GRID_HEIGHT*u.TILE_SIZE-u.VIEWPORT_HEIGHT,a.default.position[1]-Math.floor(u.VIEWPORT_HEIGHT/2))),t.translate(-Math.floor(c),-Math.floor(l))},getBounds:function(){return{x:c,y:l,w:u.VIEWPORT_WIDTH,h:u.VIEWPORT_HEIGHT}}}},{"./dimensions":6,"./events":8,"./player":9}],5:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t("./events"),s=i(a),u=t("./dimensions"),c=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(u),l=t("./assets"),h=t("./projectiles"),f=i(h),d=t("./projectile"),p=i(d),y=t("./utils"),_=function(){function t(e){o(this,t),e=e||{},this.id=Math.floor(1e4*Math.random()),this.width=c.DRONE_SIZE,this.height=c.DRONE_SIZE,this.scale=1,this.velocityX=0,this.velocityY=0,this.acceleratorX=0,this.acceleratorY=0,this.leftDown=!1,this.rightDown=!1,this.center=[c.VIEWPORT_WIDTH/2-this.width/2,c.VIEWPORT_HEIGHT/2-this.height/2],this.position=e.position||[c.MAP_PIXEL_WIDTH/2-this.width/2,c.MAP_PIXEL_HEIGHT/2-this.height/2],this.rotation=0,this.hasPackage=!1,this.explosionFrame=-1}return r(t,[{key:"update",value:function(t){"function"==typeof this._update&&this._update(t),this.velocityX+=this.acceleratorX*t,this.velocityY+=this.acceleratorY*t,this.velocityX=(0,y.clamp)(this.velocityX,-1,1),this.velocityY=(0,y.clamp)(this.velocityY,-1,1),this.checkOOB(),this.position[0]+=this.velocityX*t,this.position[1]+=this.velocityY*t,(this.leftDown||this.rightDown)&&this.leftDown!==this.rightDown&&(this.rotation+=.005*t*(this.leftDown?-1:1)),this.explosionFrame>0&&(this.scale-=.01)}},{key:"draw",value:function(t,e){this.update(e),this.explosionFrame>=0&&(this.explosionFrame+=.1),t.save(),t.translate(Math.floor(this.position[0]),Math.floor(this.position[1])),t.rotate(this.rotation),this.drawSprite(t),t.restore()}},{key:"drawSprite",value:function(t){t.drawImage(l.images.drone,Math.floor(-c.DRONE_SIZE/2),Math.floor(-c.DRONE_SIZE/2),c.DRONE_SIZE*this.scale,c.DRONE_SIZE*this.scale)}},{key:"moveLeft",value:function(){this.acceleratorX=-.002}},{key:"moveRight",value:function(){this.acceleratorX=.002}},{key:"moveUp",value:function(){this.acceleratorY=-.002}},{key:"moveDown",value:function(){this.acceleratorY=.002}},{key:"stopHorizontalMovement",value:function(){this.acceleratorX=0}},{key:"stopVerticalMovement",value:function(){this.acceleratorY=0}},{key:"shoot",value:function(){f.default.push(new p.default({direction:this.rotation,position:this.position.slice(),playerID:this.id}))}},{key:"explode",value:function(){this.explosionFrame=0,s.default.explode.dispatch()}},{key:"checkOOB",value:function(){this.position[0]<0?(this.position[0]=1,this.velocityX=.05,this.acceleratorX=5e-6):this.position[0]>c.MAP_PIXEL_WIDTH?(this.position[0]=c.GRID_WIDTH*c.TILE_SIZE,this.velocityX=-.05,this.acceleratorX=-5e-6):this.position[1]<0?(this.position[1]=1,this.velocityY=.05,this.acceleratorY=5e-6):this.position[1]>c.MAP_PIXEL_HEIGHT&&(this.position[1]=c.GRID_HEIGHT*c.TILE_SIZE,this.velocityY=-.05,this.acceleratorY=-5e-6)}},{key:"distanceFrom",value:function(t){var e=t.position[0]-this.position[0],n=t.position[1]-this.position[1];return Math.sqrt(e*e+n*n)}}]),t}();n.default=_},{"./assets":3,"./dimensions":6,"./events":8,"./projectile":10,"./projectiles":11,"./utils":13}],6:[function(t,e,n){"use strict";function i(t){var e=t.canvas,n=e.width,i=e.height;return n<i?n/o:i/r}Object.defineProperty(n,"__esModule",{value:!0}),n.getScale=i;var o=n.VIEWPORT_WIDTH=1024,r=n.VIEWPORT_HEIGHT=1024,a=n.TILE_SIZE=128,s=(n.DRONE_SIZE=128,n.GRID_WIDTH=128),u=n.GRID_HEIGHT=128;n.MAP_PIXEL_WIDTH=s*a,n.MAP_PIXEL_HEIGHT=u*a},{}],7:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t("./copter"),c=i(u),l=t("./assets"),h=t("./dimensions"),f=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(h),d=t("./player"),p=i(d),y=t("./utils"),_=function(t){function e(){return o(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"drawSprite",value:function(t){t.drawImage(l.images.drone_enemy,-f.DRONE_SIZE/2,-f.DRONE_SIZE/2,f.DRONE_SIZE*this.scale,f.DRONE_SIZE*this.scale),this.explosionFrame>0&&t.drawImage(l.images.explosion,64*Math.floor(Math.floor(this.explosionFrame)/5),Math.floor(this.explosionFrame)%5*64,64,64,-f.DRONE_SIZE/2,-f.DRONE_SIZE/2,f.DRONE_SIZE,f.DRONE_SIZE)}},{key:"_update",value:function(t){var e=this.distanceFrom(p.default);if(e<f.VIEWPORT_WIDTH/1.1&&Math.random()>.98&&this.shoot(),e<f.VIEWPORT_WIDTH){this.rotation=(0,y.getAngle)([this.position[0],this.position[1],p.default.position[0],p.default.position[1]]);var n=this.rotation<0&&this.rotation>Math.PI/-2||this.rotation>Math.PI&&this.rotation<1.5*Math.PI?-1:1,i=this.rotation>Math.PI/-2&&this.rotation<Math.PI/2?-1:1;this.acceleratorX=Math.random()/7500*n,this.acceleratorY=Math.random()/7500*i}else this.acceleratorX=(Math.random()-Math.random())/5e3,this.acceleratorY=(Math.random()-Math.random())/5e3}}]),e}(c.default);n.default=_},{"./assets":3,"./copter":5,"./dimensions":6,"./player":9,"./utils":13}],8:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("quark-signal"),o=function(t){return t&&t.__esModule?t:{default:t}}(i);n.default={keyDown:new o.default,keyUp:new o.default,imagesLoaded:new o.default,explode:new o.default}},{"quark-signal":2}],9:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t("./events"),c=i(u),l=t("./copter"),h=i(l),f=function(t){function e(){o(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._handleKeyDown=t._handleKeyDown.bind(t),t._handleKeyUp=t._handleKeyUp.bind(t),t._bind(),t}return a(e,t),s(e,[{key:"_handleKeyDown",value:function(t){"a"==t.key?this.moveLeft():"d"==t.key?this.moveRight():"w"==t.key?this.moveUp():"s"==t.key?this.moveDown():"ArrowLeft"==t.key?this.leftDown=!0:"ArrowRight"==t.key?this.rightDown=!0:"Space"==t.code&&this.shoot()}},{key:"_handleKeyUp",value:function(t){"a"==t.key||"d"==t.key?this.stopHorizontalMovement():"w"==t.key||"s"==t.key?this.stopVerticalMovement():"ArrowLeft"==t.key?this.leftDown=!1:"ArrowRight"==t.key&&(this.rightDown=!1)}},{key:"_bind",value:function(){c.default.keyDown.add(this._handleKeyDown),c.default.keyUp.add(this._handleKeyUp)}}]),e}(h.default);n.default=new f},{"./copter":5,"./events":8}],10:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e){i(this,t),this.playerID=e.playerID,this.created=Date.now(),this.direction=e.direction,this.velocity=20,this.position=e.position,this.width=8,this.height=164/6,this.image=new Image,this.image.src="./static/bullet.png"}return o(t,[{key:"update",value:function(){this.position[0]+=Math.sin(this.direction)*this.velocity,this.position[1]-=Math.cos(this.direction)*this.velocity}},{key:"draw",value:function(t){t.save(),t.translate(this.position[0],this.position[1]),t.rotate(this.direction),t.drawImage(this.image,1,0,this.width,this.height),t.restore()}},{key:"detectCollision",value:function(t){return this.position[0]>t.position[0]-t.width/2&&this.position[0]<t.position[0]+t.width/2&&this.position[1]>t.position[1]-t.height/2&&this.position[1]<t.position[1]+t.height/2}}]),t}();n.default=r},{}],11:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=[]},{}],12:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("./utils"),o=t("./dimensions"),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(o),a=t("./assets"),s=t("./camera"),u=function(t){return t&&t.__esModule?t:{default:t}}(s),c={GRASS:0,ROAD_H:1,ROAD_V:2,ROAD_INTERSECTION:3,RESERVED:4},l=["grass","road1","road2","road3","grass"],h=void 0,f=[],d=function(){for(var t=0;t<r.GRID_WIDTH;t+=1)if(!(Math.random()<.75)){for(var e=0;e<r.GRID_HEIGHT;e+=1){var n=e*r.GRID_WIDTH+t;h[n]=h[n]===c.GRASS?c.ROAD_V:c.ROAD_INTERSECTION}t+=4}for(var i=0;i<r.GRID_HEIGHT;i+=1)if(!(Math.random()<.75)){for(var o=0;o<r.GRID_WIDTH;o+=1){var a=i*r.GRID_WIDTH+o;h[a]=h[a]===c.GRASS?c.ROAD_H:c.ROAD_INTERSECTION}i+=2}},p=function(){var t,e,n,o,a=!1;for(o=1;o<r.GRID_HEIGHT;o+=1){for(t=0,a=!1,n=0;n<r.GRID_WIDTH;n+=1)e=o*r.GRID_WIDTH+n,h[e]===c.GRASS?t+=1:t=0,t<2||(t=0,h[(o-1)*r.GRID_WIDTH+n]===c.GRASS&&(Math.random()<.1||(a=!0,h[e]=c.RESERVED,h[e-1]=c.RESERVED,f.push({image:"house"+(0,i.rand)(1,10),x:(n-1)*r.TILE_SIZE,y:(o-1)*r.TILE_SIZE,width:2*r.TILE_SIZE,height:2*r.TILE_SIZE,filter:"hue-rotate("+(0,i.rand)(0,360)+"deg)"}),n+=1)));a&&(o+=1)}};n.default={generate:function(){h=Array.from(Array(r.GRID_WIDTH*r.GRID_HEIGHT)).map(function(t){return c.GRASS}),d(),p()},draw:function(t){var e=u.default.getBounds(),n=void 0,i=void 0,o=void 0;for(i=0;i<r.GRID_HEIGHT;i+=1)if(!((i+1)*r.TILE_SIZE<e.y||i*r.TILE_SIZE>e.y+e.h))for(o=0;o<r.GRID_WIDTH;o+=1)(o+1)*r.TILE_SIZE<e.x||o*r.TILE_SIZE>e.x+e.w||(n=h[i*r.GRID_WIDTH+o],t.drawImage(a.images[l[n]],Math.floor(o*r.TILE_SIZE),Math.floor(i*r.TILE_SIZE),r.TILE_SIZE,r.TILE_SIZE));t.save(),f.forEach(function(n){n.y+n.height<e.y||n.y>e.y+e.h||n.x+n.width<e.x||n.x>e.x+e.w||(t.filter=n.filter,t.drawImage(a.images[n.image],n.x,n.y,n.width,n.height))}),t.restore()}}},{"./assets":3,"./camera":4,"./dimensions":6,"./utils":13}],13:[function(t,e,n){"use strict";function i(t,e){return t+Math.floor(Math.random()*(e-t))}function o(t,e,n){return Math.min(Math.max(t,e),n)}function r(t){var e=a(t,4),n=e[0],i=e[1],o=e[2],r=e[3];return Math.atan2(r-i,o-n)+Math.PI/2}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.rand=i,n.clamp=o,n.getAngle=r},{}]},{},[1]);
