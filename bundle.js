!function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return r(n||e)},l,l.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(){var e=Date.now()-O;O=Date.now(),D.save(),D.clearRect(0,0,m.width,m.height);var t=c.getScale(D);D.scale(t,t),y.default.translate(D),s.default.draw(D),E.default.length>0&&b.length>0&&E.default.forEach(function(e,t){for(var n=0;n<b.length;n++){var i=b[n];if(e.detectCollision(i)){i.explode(),E.default.splice(t,1);break}}}),E.default.forEach(function(e){e.update(),e.draw(D)}),b.forEach(function(t,n){t.scale<.4?b.splice(n,1):t.draw(D,e)}),h.default.draw(D,e),D.restore(),requestAnimationFrame(r)}function o(){for(var e=0;e<4;e+=1)b.push(new p.default({position:[Math.random()*c.VIEWPORT_WIDTH,Math.random()*c.VIEWPORT_HEIGHT]}))}var a=e("./src/tiles"),s=i(a),u=e("./src/dimensions"),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),l=e("./src/copter"),f=(i(l),e("./src/player")),h=i(f),d=e("./src/enemy"),p=i(d),v=e("./src/camera"),y=i(v),_=e("./src/events"),I=i(_),w=e("./src/assets"),g=e("./src/projectiles"),E=i(g),m=document.querySelector("canvas");m.width=512,m.height=512;var D=m.getContext("2d"),O=Date.now(),b=[];s.default.generate();var T=function(){var e=Math.min(window.innerWidth,window.innerHeight);m.width=e,m.height=e};T(),window.addEventListener("resize",T),window.addEventListener("keydown",function(e){I.default.keyDown.dispatch(e)}),window.addEventListener("keyup",function(e){I.default.keyUp.dispatch(e)}),(0,w.loadImages)().then(r).then(o)},{"./src/assets":3,"./src/camera":4,"./src/copter":5,"./src/dimensions":6,"./src/enemy":7,"./src/events":8,"./src/player":9,"./src/projectiles":11,"./src/tiles":12}],2:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(){i(this,e),this._listeners=[],this._dispatchNb=0}return o(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{priority:0,once:!1,context:this},n=r({context:this},t,{function:e});if("function"!=typeof n.function)throw new TypeError("Signal.add() : First argument must be a Function");if(-1!==this._getListernerIndex(n.function,n.context))throw new Error("Signal.add() : Listener already exists");return this._listeners.push(n),this._listeners.sort(function(e,t){return e.priority<t.priority}),this}},{key:"once",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.add(e,r({},t,{once:!0}))}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;if("function"!=typeof e)throw new TypeError("Signal.remove() : First argument must be a Function");var n=this._getListernerIndex(e,t);if(-1===n)throw new Error("Signal.remove() : Listener does not exist");return this._listeners.splice(n,1),this}},{key:"removeAll",value:function(){return this._listeners=[],this}},{key:"dispatch",value:function(){if(++this._dispatchNb>512)throw new Error("Signal.dispatch() : Maximum dispatch limit reached (prevent infinite loop)");for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0;i<this._listeners.length;i++){var r,o=this._listeners[i];o.once&&this._listeners.splice(i);if(!1===(r=o.function).call.apply(r,[o.context].concat(t)))break}return this}},{key:"has",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return-1!==this._getListernerIndex(e,t)}},{key:"getListenersNb",value:function(){return this._listeners.length}},{key:"getDispatchNb",value:function(){return this._dispatchNb}},{key:"_getListernerIndex",value:function(e,t){for(var n=0,i=this._listeners.length;n<i;n++)if(this._listeners[n].function===e&&this._listeners[n].context===t)return n;return-1}}]),e}();n.default=a,t.exports=n.default},{}],3:[function(e,t,n){"use strict";function i(){return Promise.all(Object.keys(a).map(function(e){return new Promise(function(t,n){var i=new Image;i.onload=function(){a[e]=i,t()},i.onerror=n,i.src=a[e]})})).then(function(){return o.default.imagesLoaded.dispatch(a),a})}Object.defineProperty(n,"__esModule",{value:!0}),n.images=void 0,n.loadImages=i;var r=e("./events"),o=function(e){return e&&e.__esModule?e:{default:e}}(r),a=n.images={drone:"./static/drone.png",drone_enemy:"./static/drone_enemy.png",grass:"./static/grass.png",road1:"./static/road1.png",road2:"./static/road2.png",road3:"./static/road3.png",house1:"./static/house-1.png",house2:"./static/house-2.png",house3:"./static/house-3.png",house4:"./static/house-4.png",house5:"./static/house-5.png",house6:"./static/house-6.png",house7:"./static/house-7.png",house8:"./static/house-8.png",house9:"./static/house-9.png",house10:"./static/house-10.png"}},{"./events":8}],4:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./events"),o=(i(r),e("./player")),a=i(o),s=e("./dimensions"),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(s),c=0,l=0;n.default={translate:function(e){c=Math.max(0,Math.min(u.GRID_WIDTH*u.TILE_SIZE-u.VIEWPORT_WIDTH,a.default.position[0]-Math.floor(u.VIEWPORT_WIDTH/2))),l=Math.max(0,Math.min(u.GRID_HEIGHT*u.TILE_SIZE-u.VIEWPORT_HEIGHT,a.default.position[1]-Math.floor(u.VIEWPORT_HEIGHT/2))),e.translate(-Math.floor(c),-Math.floor(l))},getBounds:function(){return{x:c,y:l,w:u.VIEWPORT_WIDTH,h:u.VIEWPORT_HEIGHT}}}},{"./dimensions":6,"./events":8,"./player":9}],5:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("./events"),s=(i(a),e("./dimensions")),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(s),c=e("./assets"),l=e("./projectiles"),f=i(l),h=e("./projectile"),d=i(h),p=e("./utils"),v=function(){function e(t){r(this,e),t=t||{},this.width=u.DRONE_SIZE,this.height=u.DRONE_SIZE,this.scale=1,this.velocityX=0,this.velocityY=0,this.acceleratorX=0,this.acceleratorY=0,this.leftDown=!1,this.rightDown=!1,this.center=[u.VIEWPORT_WIDTH/2-this.width/2,u.VIEWPORT_HEIGHT/2-this.height/2],this.position=t.position||[u.VIEWPORT_WIDTH/2-this.width/2,u.VIEWPORT_HEIGHT/2-this.height/2],this.rotation=0,this.hasPackage=!1}return o(e,[{key:"update",value:function(e){this.velocityX+=this.acceleratorX*e,this.velocityY+=this.acceleratorY*e,this.velocityX=(0,p.clamp)(this.velocityX,-1,1),this.velocityY=(0,p.clamp)(this.velocityY,-1,1),this.position[0]+=this.velocityX*e,this.position[1]+=this.velocityY*e,(this.leftDown||this.rightDown)&&this.leftDown!==this.rightDown&&(this.rotation+=.005*e*(this.leftDown?-1:1)),this.isExploding&&(this.scale-=.05)}},{key:"draw",value:function(e,t){this.update(t),e.save(),e.translate(Math.floor(this.position[0]),Math.floor(this.position[1])),e.rotate(this.rotation),this.drawSprite(e),e.restore()}},{key:"drawSprite",value:function(e){e.drawImage(c.images.drone,Math.floor(-u.DRONE_SIZE/2),Math.floor(-u.DRONE_SIZE/2),u.DRONE_SIZE*this.scale,u.DRONE_SIZE*this.scale)}},{key:"moveLeft",value:function(){this.acceleratorX=-.002}},{key:"moveRight",value:function(){this.acceleratorX=.002}},{key:"moveUp",value:function(){this.acceleratorY=-.002}},{key:"moveDown",value:function(){this.acceleratorY=.002}},{key:"stopHorizontalMovement",value:function(){this.acceleratorX=0}},{key:"stopVerticalMovement",value:function(){this.acceleratorY=0}},{key:"shoot",value:function(){f.default.push(new d.default({direction:this.rotation,position:this.position.slice()}))}},{key:"explode",value:function(){this.isExploding=!0}}]),e}();n.default=v},{"./assets":3,"./dimensions":6,"./events":8,"./projectile":10,"./projectiles":11,"./utils":13}],6:[function(e,t,n){"use strict";function i(e){var t=e.canvas,n=t.width,i=t.height;return n<i?n/r:i/o}Object.defineProperty(n,"__esModule",{value:!0}),n.getScale=i;var r=n.VIEWPORT_WIDTH=1024,o=n.VIEWPORT_HEIGHT=1024;n.TILE_SIZE=128,n.DRONE_SIZE=128,n.GRID_WIDTH=128,n.GRID_HEIGHT=128},{}],7:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("./copter"),u=function(e){return e&&e.__esModule?e:{default:e}}(s),c=e("./assets"),l=e("./dimensions"),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(l),h=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"drawSprite",value:function(e){e.drawImage(c.images.drone_enemy,-f.DRONE_SIZE/2,-f.DRONE_SIZE/2,f.DRONE_SIZE*this.scale,f.DRONE_SIZE*this.scale)}}]),t}(u.default);n.default=h},{"./assets":3,"./copter":5,"./dimensions":6}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("quark-signal"),r=function(e){return e&&e.__esModule?e:{default:e}}(i);n.default={keyDown:new r.default,keyUp:new r.default,imagesLoaded:new r.default}},{"quark-signal":2}],9:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./events"),c=i(u),l=e("./copter"),f=i(l),h=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._handleKeyDown=e._handleKeyDown.bind(e),e._handleKeyUp=e._handleKeyUp.bind(e),e._bind(),e}return a(t,e),s(t,[{key:"_handleKeyDown",value:function(e){"a"==e.key?this.moveLeft():"d"==e.key?this.moveRight():"w"==e.key?this.moveUp():"s"==e.key?this.moveDown():"ArrowLeft"==e.key?this.leftDown=!0:"ArrowRight"==e.key?this.rightDown=!0:"Space"==e.code&&this.shoot()}},{key:"_handleKeyUp",value:function(e){"a"==e.key||"d"==e.key?this.stopHorizontalMovement():"w"==e.key||"s"==e.key?this.stopVerticalMovement():"ArrowLeft"==e.key?this.leftDown=!1:"ArrowRight"==e.key&&(this.rightDown=!1)}},{key:"_bind",value:function(){c.default.keyDown.add(this._handleKeyDown),c.default.keyUp.add(this._handleKeyUp)}}]),t}(f.default);n.default=new h},{"./copter":5,"./events":8}],10:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){i(this,e),this.direction=t.direction,this.velocity=20,this.position=t.position,this.width=8,this.height=164/6,this.image=new Image,this.image.src="./static/bullet.png"}return r(e,[{key:"update",value:function(){this.position[0]+=Math.sin(this.direction)*this.velocity,this.position[1]-=Math.cos(this.direction)*this.velocity}},{key:"draw",value:function(e){e.save(),e.translate(this.position[0],this.position[1]),e.rotate(this.direction),e.drawImage(this.image,1,0,this.width,this.height),e.restore()}},{key:"detectCollision",value:function(e){return this.position[0]>e.position[0]-e.width/2&&this.position[0]<e.position[0]+e.width/2&&this.position[1]>e.position[1]-e.height/2&&this.position[1]<e.position[1]+e.height/2}}]),e}();n.default=o},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=[]},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./utils"),r=e("./dimensions"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(r),a=e("./assets"),s=e("./camera"),u=function(e){return e&&e.__esModule?e:{default:e}}(s),c={GRASS:0,ROAD_H:1,ROAD_V:2,ROAD_INTERSECTION:3,RESERVED:4},l=["grass","road1","road2","road3","grass"],f=void 0,h=[],d=function(){for(var e=0;e<o.GRID_WIDTH;e+=1)if(!(Math.random()<.75)){for(var t=0;t<o.GRID_HEIGHT;t+=1){var n=t*o.GRID_WIDTH+e;f[n]=f[n]===c.GRASS?c.ROAD_V:c.ROAD_INTERSECTION}e+=4}for(var i=0;i<o.GRID_HEIGHT;i+=1)if(!(Math.random()<.75)){for(var r=0;r<o.GRID_WIDTH;r+=1){var a=i*o.GRID_WIDTH+r;f[a]=f[a]===c.GRASS?c.ROAD_H:c.ROAD_INTERSECTION}i+=2}},p=function(){var e,t,n,r,a=!1;for(r=1;r<o.GRID_HEIGHT;r+=1){for(e=0,a=!1,n=0;n<o.GRID_WIDTH;n+=1)t=r*o.GRID_WIDTH+n,f[t]===c.GRASS?e+=1:e=0,e<2||(e=0,f[(r-1)*o.GRID_WIDTH+n]===c.GRASS&&(Math.random()<.1||(a=!0,f[t]=c.RESERVED,f[t-1]=c.RESERVED,h.push({image:"house"+(0,i.rand)(1,10),x:(n-1)*o.TILE_SIZE,y:(r-1)*o.TILE_SIZE,width:2*o.TILE_SIZE,height:2*o.TILE_SIZE,filter:"hue-rotate("+(0,i.rand)(0,360)+"deg)"}),n+=1)));a&&(r+=1)}};n.default={generate:function(){f=Array.from(Array(o.GRID_WIDTH*o.GRID_HEIGHT)).map(function(e){return c.GRASS}),d(),p()},draw:function(e){var t=u.default.getBounds(),n=void 0,i=void 0,r=void 0;for(i=0;i<o.GRID_HEIGHT;i+=1)if(!((i+1)*o.TILE_SIZE<t.y||i*o.TILE_SIZE>t.y+t.h))for(r=0;r<o.GRID_WIDTH;r+=1)(r+1)*o.TILE_SIZE<t.x||r*o.TILE_SIZE>t.x+t.w||(n=f[i*o.GRID_WIDTH+r],e.drawImage(a.images[l[n]],Math.floor(r*o.TILE_SIZE),Math.floor(i*o.TILE_SIZE),o.TILE_SIZE,o.TILE_SIZE));e.save(),h.forEach(function(n){n.y+n.height<t.y||n.y>t.y+t.h||n.x+n.width<t.x||n.x>t.x+t.w||(e.filter=n.filter,e.drawImage(a.images[n.image],n.x,n.y,n.width,n.height))}),e.restore()}}},{"./assets":3,"./camera":4,"./dimensions":6,"./utils":13}],13:[function(e,t,n){"use strict";function i(e,t){return e+Math.floor(Math.random()*(t-e))}function r(e,t,n){return Math.min(Math.max(e,t),n)}Object.defineProperty(n,"__esModule",{value:!0}),n.rand=i,n.clamp=r},{}]},{},[1]);
