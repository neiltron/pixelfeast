!function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(){var e=Date.now()-b;b=Date.now(),O.save(),O.clearRect(0,0,g.width,g.height);var t=c.getScale(O);O.scale(t,t),y.default.translate(O),s.default.draw(O),E.default.forEach(function(e){e.update(),e.draw(O)}),T.forEach(function(t){t.draw(O,e)}),h.default.draw(O,e),O.restore(),requestAnimationFrame(i)}function o(){for(var e=0;e<4;e+=1)T.push(new p.default({position:[Math.random()*c.VIEWPORT_WIDTH,Math.random()*c.VIEWPORT_HEIGHT]}))}var a=e("./src/tiles"),s=r(a),u=e("./src/dimensions"),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),l=e("./src/copter"),f=(r(l),e("./src/player")),h=r(f),d=e("./src/enemy"),p=r(d),v=e("./src/camera"),y=r(v),_=e("./src/events"),w=r(_),I=e("./src/assets"),m=e("./src/projectiles"),E=r(m),g=document.querySelector("canvas");g.width=512,g.height=512;var O=g.getContext("2d"),b=Date.now(),T=[];s.default.generate();var D=function(){var e=Math.min(window.innerWidth,window.innerHeight);g.width=e,g.height=e};D(),window.addEventListener("resize",D),window.addEventListener("keydown",function(e){w.default.keyDown.dispatch(e)}),window.addEventListener("keyup",function(e){w.default.keyUp.dispatch(e)}),(0,I.loadImages)().then(i).then(o)},{"./src/assets":3,"./src/camera":4,"./src/copter":5,"./src/dimensions":6,"./src/enemy":7,"./src/events":8,"./src/player":9,"./src/projectiles":11,"./src/tiles":12}],2:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this._listeners=[],this._dispatchNb=0}return o(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{priority:0,once:!1,context:this},n=i({context:this},t,{function:e});if("function"!=typeof n.function)throw new TypeError("Signal.add() : First argument must be a Function");if(-1!==this._getListernerIndex(n.function,n.context))throw new Error("Signal.add() : Listener already exists");return this._listeners.push(n),this._listeners.sort(function(e,t){return e.priority<t.priority}),this}},{key:"once",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.add(e,i({},t,{once:!0}))}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;if("function"!=typeof e)throw new TypeError("Signal.remove() : First argument must be a Function");var n=this._getListernerIndex(e,t);if(-1===n)throw new Error("Signal.remove() : Listener does not exist");return this._listeners.splice(n,1),this}},{key:"removeAll",value:function(){return this._listeners=[],this}},{key:"dispatch",value:function(){if(++this._dispatchNb>512)throw new Error("Signal.dispatch() : Maximum dispatch limit reached (prevent infinite loop)");for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<this._listeners.length;r++){var i,o=this._listeners[r];o.once&&this._listeners.splice(r);if(!1===(i=o.function).call.apply(i,[o.context].concat(t)))break}return this}},{key:"has",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return-1!==this._getListernerIndex(e,t)}},{key:"getListenersNb",value:function(){return this._listeners.length}},{key:"getDispatchNb",value:function(){return this._dispatchNb}},{key:"_getListernerIndex",value:function(e,t){for(var n=0,r=this._listeners.length;n<r;n++)if(this._listeners[n].function===e&&this._listeners[n].context===t)return n;return-1}}]),e}();n.default=a,t.exports=n.default},{}],3:[function(e,t,n){"use strict";function r(){return Promise.all(Object.keys(a).map(function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){a[e]=r,t()},r.onerror=n,r.src=a[e]})})).then(function(){return o.default.imagesLoaded.dispatch(a),a})}Object.defineProperty(n,"__esModule",{value:!0}),n.images=void 0,n.loadImages=r;var i=e("./events"),o=function(e){return e&&e.__esModule?e:{default:e}}(i),a=n.images={drone:"/static/drone.png",drone_enemy:"/static/drone_enemy.png",grass:"./static/grass.png",road:"./static/road.png"}},{"./events":8}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./events"),o=(r(i),e("./player")),a=r(o),s=e("./dimensions"),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(s),c=0,l=0;n.default={translate:function(e){c=Math.max(0,Math.min(u.GRID_WIDTH*u.TILE_SIZE-u.VIEWPORT_WIDTH,a.default.position[0]-Math.floor(u.VIEWPORT_WIDTH/2))),l=Math.max(0,Math.min(u.GRID_HEIGHT*u.TILE_SIZE-u.VIEWPORT_HEIGHT,a.default.position[1]-Math.floor(u.VIEWPORT_HEIGHT/2))),e.translate(-c,-l)},getBounds:function(){return{x:c,y:l,w:u.VIEWPORT_WIDTH,h:u.VIEWPORT_HEIGHT}}}},{"./dimensions":6,"./events":8,"./player":9}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./events"),s=(r(a),e("./dimensions")),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(s),c=e("./assets"),l=e("./projectiles"),f=r(l),h=e("./projectile"),d=r(h),p=e("./utils"),v=function(){function e(t){i(this,e),t=t||{},this.width=u.DRONE_SIZE,this.height=u.DRONE_SIZE,this.velocityX=0,this.velocityY=0,this.acceleratorX=0,this.acceleratorY=0,this.leftDown=!1,this.rightDown=!1,this.center=[u.VIEWPORT_WIDTH/2-this.width/2,u.VIEWPORT_HEIGHT/2-this.height/2],this.position=t.position||[u.VIEWPORT_WIDTH/2-this.width/2,u.VIEWPORT_HEIGHT/2-this.height/2],this.rotation=0,this.hasPackage=!1}return o(e,[{key:"draw",value:function(e,t){this.velocityX+=this.acceleratorX*t,this.velocityY+=this.acceleratorY*t,this.velocityX=(0,p.clamp)(this.velocityX,-1,1),this.velocityY=(0,p.clamp)(this.velocityY,-1,1),this.position[0]+=this.velocityX*t,this.position[1]+=this.velocityY*t,(this.leftDown||this.rightDown)&&this.leftDown!==this.rightDown&&(this.rotation+=.005*t*(this.leftDown?-1:1)),e.save(),e.translate(Math.floor(this.position[0]),Math.floor(this.position[1])),e.rotate(this.rotation),this.drawSprite(e),e.restore()}},{key:"drawSprite",value:function(e){e.drawImage(c.images.drone,Math.floor(-u.DRONE_SIZE/2),Math.floor(-u.DRONE_SIZE/2),u.DRONE_SIZE,u.DRONE_SIZE)}},{key:"moveLeft",value:function(){this.acceleratorX=-.002}},{key:"moveRight",value:function(){this.acceleratorX=.002}},{key:"moveUp",value:function(){this.acceleratorY=-.002}},{key:"moveDown",value:function(){this.acceleratorY=.002}},{key:"stopHorizontalMovement",value:function(){this.acceleratorX=0}},{key:"stopVerticalMovement",value:function(){this.acceleratorY=0}},{key:"shoot",value:function(){f.default.push(new d.default({direction:this.rotation,position:this.position.slice()}))}}]),e}();n.default=v},{"./assets":3,"./dimensions":6,"./events":8,"./projectile":10,"./projectiles":11,"./utils":13}],6:[function(e,t,n){"use strict";function r(e){var t=e.canvas,n=t.width,r=t.height;return n<r?n/i:r/o}Object.defineProperty(n,"__esModule",{value:!0}),n.getScale=r;var i=n.VIEWPORT_WIDTH=1024,o=n.VIEWPORT_HEIGHT=1024;n.TILE_SIZE=64,n.DRONE_SIZE=128,n.GRID_WIDTH=128,n.GRID_HEIGHT=128},{}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./copter"),u=function(e){return e&&e.__esModule?e:{default:e}}(s),c=e("./assets"),l=e("./dimensions"),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(l),h=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"drawSprite",value:function(e){e.drawImage(c.images.drone_enemy,-f.DRONE_SIZE/2,-f.DRONE_SIZE/2,f.DRONE_SIZE,f.DRONE_SIZE)}}]),t}(u.default);n.default=h},{"./assets":3,"./copter":5,"./dimensions":6}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("quark-signal"),i=function(e){return e&&e.__esModule?e:{default:e}}(r);n.default={keyDown:new i.default,keyUp:new i.default,imagesLoaded:new i.default}},{"quark-signal":2}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./events"),c=r(u),l=e("./copter"),f=r(l),h=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._handleKeyDown=e._handleKeyDown.bind(e),e._handleKeyUp=e._handleKeyUp.bind(e),e._bind(),e}return a(t,e),s(t,[{key:"_handleKeyDown",value:function(e){"a"==e.key?this.moveLeft():"d"==e.key?this.moveRight():"w"==e.key?this.moveUp():"s"==e.key?this.moveDown():"ArrowLeft"==e.key?this.rotate(-1):"ArrowRight"==e.key?this.rotate(1):"Space"==e.code&&this.shoot()}},{key:"_handleKeyUp",value:function(e){"a"==e.key||"d"==e.key?this.stopHorizontalMovement():"w"!=e.key&&"s"!=e.key||this.stopVerticalMovement()}},{key:"_bind",value:function(){c.default.keyDown.add(this._handleKeyDown),c.default.keyUp.add(this._handleKeyUp)}}]),t}(f.default);n.default=new h},{"./copter":5,"./events":8}],10:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){r(this,e),this.direction=t.direction,this.velocity=20,this.position=t.position,this.width=8,this.height=164/6,this.image=new Image,this.image.src="./static/bullet.png"}return i(e,[{key:"update",value:function(){this.position[0]+=Math.sin(this.direction)*this.velocity,this.position[1]-=Math.cos(this.direction)*this.velocity}},{key:"draw",value:function(e){e.save(),e.translate(this.position[0],this.position[1]),e.rotate(this.direction),e.drawImage(this.image,1,0,this.width,this.height),e.restore()}}]),e}();n.default=o},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=[]},{}],12:[function(e,t,n){"use strict";function r(e){for(var t=d.NORTH,n=d.EAST,r=d.SOUTH,i=d.WEST,a=e,u=s.GRID_HEIGHT-1,c=t,l=void 0,h=0,v=1;u>=0;)p[u*s.GRID_WIDTH+a]=f.ROAD,h>v&&(h=0,v=(0,o.rand)(3,5),c===t?l=[t,n,i]:c===r?l=[n,i]:c===n?l=[t,n]:c===i&&(l=[t,i]),c=l[(0,o.rand)(0,l.length)]),h+=1,a=Math.max(0,Math.min(s.GRID_WIDTH-1,a+c[0])),u=Math.min(s.GRID_WIDTH-1,u+c[1])}function i(e){for(var t=d.NORTH,n=d.EAST,r=d.SOUTH,i=d.WEST,a=s.GRID_WIDTH-1,u=e,c=i,l=void 0,h=0,v=1;a>=0;)p[u*s.GRID_WIDTH+a]=f.ROAD,h>v&&(h=0,v=(0,o.rand)(3,5),c===i?l=[i,t,r]:c===n?l=[t,r]:c===t?l=[i,t]:c===r&&(l=[i,r]),c=l[(0,o.rand)(0,l.length)]),h+=1,a=Math.min(s.GRID_WIDTH-1,a+c[0]),u=Math.max(0,Math.min(s.GRID_WIDTH-1,u+c[1]))}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./utils"),a=e("./dimensions"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(a),u=e("./assets"),c=e("./camera"),l=function(e){return e&&e.__esModule?e:{default:e}}(c),f={GRASS:0,ROAD:1},h=["grass","road"],d={NORTH:[0,-1],EAST:[1,0],SOUTH:[0,1],WEST:[-1,0]},p=void 0;n.default={generate:function(){p=Array.from(Array(s.GRID_WIDTH*s.GRID_HEIGHT)).map(function(e){return f.GRASS});for(var e=0;e<s.GRID_WIDTH;e+=1)Math.random()<.1&&i(e);for(var t=0;t<s.GRID_HEIGHT;t+=1)Math.random()<.1&&r(t)},draw:function(e){var t=Math.floor(s.TILE_SIZE),n=l.default.getBounds(),r=void 0,i=void 0,o=void 0;for(i=0;i<s.GRID_HEIGHT;i+=1)if(!((i+1)*s.TILE_SIZE<n.y||i*s.TILE_SIZE>n.y+n.h))for(o=0;o<s.GRID_WIDTH;o+=1)(o+1)*s.TILE_SIZE<n.x||o*s.TILE_SIZE>n.x+n.w||(r=p[i*s.GRID_WIDTH+o],e.drawImage(u.images[h[r]],Math.floor(o*s.TILE_SIZE),Math.floor(i*s.TILE_SIZE),t+1,t+1))}}},{"./assets":3,"./camera":4,"./dimensions":6,"./utils":13}],13:[function(e,t,n){"use strict";function r(e,t){return e+Math.floor(Math.random()*(t-e))}function i(e,t,n){return Math.min(Math.max(e,t),n)}Object.defineProperty(n,"__esModule",{value:!0}),n.rand=r,n.clamp=i},{}]},{},[1]);
